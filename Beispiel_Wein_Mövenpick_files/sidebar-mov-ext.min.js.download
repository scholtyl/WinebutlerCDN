define(['jquery','Magento_Ui/js/modal/confirm','Magento_Customer/js/model/authentication-popup','Magento_Customer/js/customer-data',],function($,confirm,authenticationPopup,customerData){'use strict';return function(config){return $.widget('mage.sidebar',$.mage.sidebar,{_addQtyButtonsEvents:function(){this._super();$('.cs-cart-item__qty-input input').on('input',(event)=>{this._validateStep($(event.currentTarget),true,false);});},_addQtyButtonAction:function(event,action){event.stopPropagation();var itemId=$(event.currentTarget).data('cart-item');var qtyElement=$('#cart-item-'+itemId+'-qty');var qtyValue=parseInt(qtyElement.val(),10);const step=parseInt(qtyElement.attr('step'))||this.options.step;if((qtyValue===this.options.minValue||qtyValue<step)&&action==='qtyDecrease'){this._triggerRemove($(event.currentTarget));return;}
qtyValue=action==='qtyDecrease'?Math.max(qtyValue-step,step):qtyValue+step;qtyElement.val(qtyValue).trigger('keyup');},_showItemButton:function(elem){if(!this._validateStep(elem,false,false))return;this._super(elem);},_validateQty:function(elem){if(!this._validateStep(elem))return;this._super(elem);},_validateStep:function(elem,showMessage=true,update=true){const qty=parseInt(elem.val(),10);const step=parseInt(elem.attr('step'),10)||this.options.step;const isValid=qty%step===0;if(isValid){elem[0].setCustomValidity('');return true;}
if(update){elem.val(elem.data('item-qty'));}
if(showMessage){const message=$.mage.__('You can buy this product only in quantities of %1 at a time.').replace('%1',step);elem[0].setCustomValidity(message);setTimeout(()=>{elem[0].reportValidity();},0);}
return false;}});};});