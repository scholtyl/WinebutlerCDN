define(['jquery','mage/url','js/get-consent-status','mage/cookies'],function($,urlBuilder,getConsentStatus){'use strict';return async function(config,element){const hideRecommendationSection=()=>{const recommendationSectionId=config.recommendationSectionId??'aws_recommendation';const recommendationSectionLink=document.querySelector(`[href="#${recommendationSectionId}"]`)
if(recommendationSectionLink){recommendationSectionLink.parentElement.style.display='none';}
const recommendationSections=document.querySelector((`#${recommendationSectionId}`));if(recommendationSections){recommendationSections.style.display='none';}}
const consentStatus=await getConsentStatus('aws_recommendation');if(!consentStatus){hideRecommendationSection();return;}
const recommendationProductsEndpoint=config.recommendationProductsEndpoint??urlBuilder.build('customization_catalog/product/recommendation');const sku=config.sku;const data=sku?{'sku':sku}:{};const response=await $.ajax({url:recommendationProductsEndpoint,data:data});const{content}=response;if(!content||content===''){hideRecommendationSection();return;}
element.innerHTML=content;const formKey=$.mage.cookies.get('form_key');if(formKey){element.querySelectorAll('input[name="form_key"]').forEach(input=>input.value=formKey);}
$(element).trigger('contentUpdated');$('body').trigger('productAdded');};});